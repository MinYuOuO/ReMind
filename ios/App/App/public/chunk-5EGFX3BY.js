import{a as ye,b as Se,c as Ie}from"./chunk-HLH3V2X3.js";import{a as ve}from"./chunk-ZNLL7W3O.js";import"./chunk-WCLNVVUR.js";import{b as Ce,c as be}from"./chunk-OJQROCLB.js";import{$ as H,$a as ce,A as r,B as g,Bb as ue,C as B,Cb as fe,D as N,Db as xe,Eb as E,F as C,Fb as T,G as y,Gb as R,H as d,Hb as q,Lb as we,Mb as A,O as D,Ob as F,R as p,S as L,Sa as ie,T as f,Ta as ne,U as W,V as S,Va as oe,W as I,X as v,Ya as ae,Z as M,Za as re,_ as j,_a as se,aa as U,ab as le,ea as Q,eb as de,fa as G,fb as ge,ga as z,h as m,ha as J,i as h,ib as pe,ja as Y,jb as _e,k as w,ka as K,la as X,lb as me,mb as he,nb as P,p as o,pa as Z,pb as O,q as u,s as V,v as _,va as $,vb as k,wa as ee,y as l,z as a,za as te}from"./chunk-NFYGWNBG.js";import"./chunk-5ARS7AGD.js";import"./chunk-QUJFQN2Y.js";import"./chunk-42773FH6.js";import"./chunk-LJTVJC5R.js";import"./chunk-V35JPV4T.js";import"./chunk-XCIV33A6.js";import"./chunk-WWQJI6ZF.js";import"./chunk-FN7XDZ7X.js";import"./chunk-4WA3IE3Y.js";import"./chunk-MYWE4PUO.js";import"./chunk-6675UF34.js";import"./chunk-PYNURLWC.js";import"./chunk-VWBCFL5K.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BMA72V62.js";import"./chunk-CKP3SGE2.js";import"./chunk-EULU7H5A.js";import"./chunk-AWFO5LBT.js";import"./chunk-ZHQITZWE.js";import"./chunk-NJ63EZW4.js";import"./chunk-DEDRJWY3.js";import"./chunk-RADHBB3Y.js";import"./chunk-JHFNTCF2.js";import"./chunk-4WFVMWDK.js";import"./chunk-LRFGNCHE.js";import"./chunk-M2X7KQLB.js";import"./chunk-OZYWYLNK.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-42C7ZIID.js";import{f as b}from"./chunk-MCHWYEYM.js";function ke(i,s){if(i&1){let e=C();a(0,"ion-buttons",11)(1,"ion-button",12),y("click",function(){m(e);let t=d();return h(t.goBack())}),g(2,"ion-icon",13),r()()}}function Ee(i,s){if(i&1&&(a(0,"p",25),p(1),r()),i&2){let e=d().$implicit;o(),f(" For: ",e.contact_name," ")}}function Te(i,s){if(i&1){let e=C();a(0,"ion-item",22),y("click",function(){let t=m(e).$implicit,c=d(3);return h(c.openFromHistory(t))}),g(1,"ion-icon",23),a(2,"ion-label")(3,"h2"),p(4),r(),a(5,"p"),p(6),M(7,"titlecase"),M(8,"date"),r(),_(9,Ee,2,1,"p",24),r()()}if(i&2){let e=s.$implicit;o(4),L(e.content),o(2),W(" ",j(7,4,e.insight_type)," \u2022 ",H(8,6,e.generated_at,"short")," "),o(3),l("ngIf",e.contact_name)}}function Re(i,s){if(i&1&&(a(0,"ion-list",20),_(1,Te,10,9,"ion-item",21),r()),i&2){let e=d(2);o(),l("ngForOf",e.insights())("ngForTrackBy",e.trackByInsight)}}function qe(i,s){i&1&&(a(0,"div",26),p(1," No AI insights yet. Try asking a question "),r())}function Ae(i,s){if(i&1){let e=C();a(0,"section",14),g(1,"div",15),a(2,"div",16)(3,"ion-item",17)(4,"ion-input",18),v("ngModelChange",function(t){m(e);let c=d();return I(c.keyword,t)||(c.keyword=t),h(t)}),y("keyup.enter",function(){m(e);let t=d();return h(t.openSearch())}),r()()(),_(5,Re,2,2,"ion-list",19)(6,qe,2,0,"ng-template",null,0,U),r()}if(i&2){let e=D(7),n=d();o(4),S("ngModel",n.keyword),o(),l("ngIf",n.insights().length)("ngIfElse",e)}}function Fe(i,s){if(i&1&&(a(0,"span"),p(1),r()),i&2){let e=d().$implicit;o(),f("(",e.relationship,")")}}function Ve(i,s){if(i&1&&(a(0,"ion-select-option",41),p(1),_(2,Fe,2,1,"span",42),r()),i&2){let e=s.$implicit;l("value",e),o(),f(" ",e.name," "),o(),l("ngIf",e.relationship)}}function Be(i,s){if(i&1&&(a(0,"div",43),p(1),r()),i&2){let e=d(2);o(),f(" ",e.aiAnswer()," ")}}function Ne(i,s){if(i&1){let e=C();a(0,"section",27)(1,"ion-list",28)(2,"ion-item",29),g(3,"ion-icon",30),a(4,"ion-select",31),v("ngModelChange",function(t){m(e);let c=d();return I(c.selectedContact,t)||(c.selectedContact=t),h(t)}),_(5,Ve,3,3,"ion-select-option",32),r(),g(6,"ion-icon",33),r(),a(7,"ion-item",34),g(8,"ion-icon",35),a(9,"ion-textarea",36),v("ngModelChange",function(t){m(e);let c=d();return I(c.question,t)||(c.question=t),h(t)}),r()(),a(10,"div",37)(11,"ion-button",38),y("click",function(){m(e);let t=d();return h(t.send())}),g(12,"ion-icon",39),p(13),r()(),_(14,Be,2,1,"div",40),r()()}if(i&2){let e=d();o(4),S("ngModel",e.selectedContact),o(),l("ngForOf",e.contacts()),o(4),S("ngModel",e.question),o(2),l("disabled",e.loading()),o(2),f(" ",e.loading()?"Generating...":"Send"," "),o(),l("ngIf",e.aiAnswer())}}P({arrowBack:O,notificationsOutline:E,shieldCheckmarkOutline:A,personOutline:R,chevronDownOutline:k,reorderThreeOutline:q,paperPlaneOutline:T,settingsOutline:we,mailOutline:xe,sparklesOutline:F,lockClosedOutline:fe,informationCircleOutline:ue});var nt=(()=>{let s=class s{constructor(n,t,c,x,Me,Pe,Oe){this.contactRepo=n,this.identity=t,this.ai=c,this.aiSetting=x,this.dbInit=Me,this.db=Pe,this.router=Oe,this.view="list",this.keyword="",this.question="",this.selectedContact=null,this.contacts=w([]),this.insights=w([]),this.userId="",this.loading=w(!1),this.aiAnswer=w(""),P({arrowBack:O,notificationsOutline:E,shieldCheckmarkOutline:A,sparklesOutline:F,personOutline:R,chevronDownOutline:k,reorderThreeOutline:q,paperPlaneOutline:T})}ngOnInit(){return b(this,null,function*(){yield this.dbInit.init(),yield this.identity.ready(),this.userId=yield this.identity.ensureUserId();let n=yield this.contactRepo.listByUser(this.userId);this.contacts.set(n),yield this.loadInsights()})}loadInsights(){return b(this,null,function*(){let n=yield this.db.query(`
      SELECT
        i.*,
        c.name AS contact_name
      FROM insight i
      LEFT JOIN contact c ON c.contact_id = i.contact_id
      WHERE i.user_id = ?
      ORDER BY i.generated_at DESC
      LIMIT 50
      `,[this.userId]);this.insights.set(n)})}hasQuery(){return(this.keyword?.trim()?.length??0)>0}openSearch(){this.hasQuery()&&(this.question=this.keyword.trim(),this.view="search",this.aiAnswer.set(""))}goBack(){this.view="list",this.aiAnswer.set(""),this.keyword="",this.question=""}send(){return b(this,null,function*(){let n=(this.question||this.keyword||"").trim();if(!n){alert("Please enter a question about your friend.");return}let t=this.selectedContact;if(!t){alert("Please select a contact.");return}if(!(yield this.aiSetting.isConfigured())){confirm("AI is not set up yet. Go to AI Settings now?")&&this.router.navigate(["/settings"],{queryParams:{tab:"ai"}});return}this.loading.set(!0),this.aiAnswer.set("");try{(yield this.ai.generatePersonInsight({contact_id:t.contact_id,user_id:this.userId,type:"suggestion",question:n,actionable:1}))&&(this.aiAnswer.set("Insight generated and saved. Check your insights page."),yield this.loadInsights())}catch(x){console.error("[RSearch] AI send failed:",x),this.aiAnswer.set("Failed to generate insight.")}finally{this.loading.set(!1)}})}openFromHistory(n){if(this.view="search",this.aiAnswer.set(n.content),this.question="",n.contact_id){let t=this.contacts().find(c=>c.contact_id===n.contact_id);t&&(this.selectedContact=t)}}contactLabel(n){if(!n)return"";let t=n.relationship?` (${n.relationship})`:"";return n.name+t}trackByInsight(n,t){return t.insight_id}};s.\u0275fac=function(t){return new(t||s)(u(ye),u(Se),u(Ie),u(ve),u(be),u(Ce),u(Z))},s.\u0275cmp=V({type:s,selectors:[["app-search-list"]],decls:14,vars:5,consts:[["emptyHistory",""],[1,"page-toolbar"],["slot","start",4,"ngIf"],["slot","end"],["fill","clear"],["name","notifications-outline"],["name","shield-checkmark-outline"],[1,"page",3,"fullscreen"],[3,"ngSwitch"],["class","list-view",4,"ngSwitchCase"],["class","search-view",4,"ngSwitchCase"],["slot","start"],["fill","clear",3,"click"],["name","arrow-back"],[1,"list-view"],[1,"bg-spacer"],[1,"ask-bar"],["lines","none",1,"ask-card"],["placeholder","Ask for anything about friend",3,"ngModelChange","keyup.enter","ngModel"],["lines","none","class","history-list",4,"ngIf","ngIfElse"],["lines","none",1,"history-list"],["button","","detail","false","class","history-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["button","","detail","false",1,"history-card",3,"click"],["name","sparkles-outline","slot","start"],["class","contact-pill",4,"ngIf"],[1,"contact-pill"],[1,"empty-history"],[1,"search-view"],["lines","none",1,"form-list"],[1,"pill-card"],["name","person-outline","slot","start"],["interface","action-sheet","placeholder","Select Contact",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","chevron-down-outline","slot","end"],["lines","none",1,"question-card"],["name","reorder-three-outline","slot","start"],["auto-grow","true","placeholder","Question",3,"ngModelChange","ngModel"],[1,"send-wrap"],["expand","block",1,"send-btn",3,"click","disabled"],["slot","start","name","paper-plane-outline"],["class","ai-answer",4,"ngIf"],[3,"value"],[4,"ngIf"],[1,"ai-answer"]],template:function(t,c){t&1&&(a(0,"ion-header")(1,"ion-toolbar",1),_(2,ke,3,0,"ion-buttons",2),a(3,"ion-title"),p(4,"RSearch"),r(),a(5,"ion-buttons",3)(6,"ion-button",4),g(7,"ion-icon",5),r(),a(8,"ion-button",4),g(9,"ion-icon",6),r()()()(),a(10,"ion-content",7),B(11,8),_(12,Ae,8,3,"section",9)(13,Ne,15,6,"section",10),N(),r()),t&2&&(o(2),l("ngIf",c.view==="search"),o(8),l("fullscreen",!0),o(),l("ngSwitch",c.view),o(),l("ngSwitchCase","list"),o(),l("ngSwitchCase","search"))},dependencies:[X,Q,G,z,J,te,$,ee,ae,ge,de,oe,ne,ie,pe,re,me,le,he,ce,_e,se,Y,K],styles:['@charset "UTF-8";.page[_ngcontent-%COMP%]{--background: linear-gradient(180deg, #9fb7d6 0%, #eaf1f8 60%, #ffffff 100%)}.page-toolbar[_ngcontent-%COMP%]{background:linear-gradient(180deg,#9fb7d6,#b8c9de);color:#fff}.page-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{margin-left:50px;font-weight:800;text-align:center}.page-toolbar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff;font-size:20px}.list-view[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.bg-spacer[_ngcontent-%COMP%]{flex:1}.ask-bar[_ngcontent-%COMP%]{position:sticky;bottom:16px;padding:0 16px 8px}.ask-card[_ngcontent-%COMP%]{--background: #fff;--min-height: 44px;color:#3560c8;border-radius:14px;border:1px solid #dce3f1;box-shadow:0 6px 16px #2640781a}.ask-card[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(native){--placeholder-color: #6b7aa6;color:#1e3a8a;font-weight:600;padding-left:10px}.search-view[_ngcontent-%COMP%]{padding:12px 12px 20px}.form-list[_ngcontent-%COMP%]{background:transparent}.pill-card[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .95);border-radius:12px;border:1px solid #dce3f1;margin:8px 0 12px;box-shadow:0 8px 18px #2640781a}.pill-card[_ngcontent-%COMP%]   ion-icon[slot=start][_ngcontent-%COMP%]{color:#6b7aa6}.pill-card[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:700}.pill-card[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(text){--placeholder-color: rgba(30, 58, 138, .45)}.pill-card[_ngcontent-%COMP%]   ion-icon[slot=end][_ngcontent-%COMP%]{color:#6b7aa6}.question-card[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .95);border-radius:12px;border:1px solid #dce3f1;margin:4px 0 18px;align-items:flex-start;box-shadow:0 10px 22px #2640781f}.question-card[_ngcontent-%COMP%]   ion-icon[slot=start][_ngcontent-%COMP%]{color:#6b7aa6;margin-top:10px}.question-card[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{width:100%;min-height:110px;color:#1e3a8a;font-weight:600}.question-card[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(native){--placeholder-color: rgba(30, 58, 138, .45)}.send-wrap[_ngcontent-%COMP%]{padding:0 6px}.send-btn[_ngcontent-%COMP%]{--background: linear-gradient(180deg, #4f78e6, #3560c8);--border-radius: 12px;color:#fff;font-weight:700;box-shadow:0 12px 22px #2640782e}']});let i=s;return i})();export{nt as RSearchPage};
