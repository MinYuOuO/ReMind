import{a as P}from"./chunk-UX4CHBK3.js";import{d,l as y}from"./chunk-SEDJWNAO.js";import{e as s}from"./chunk-JHI3MBHO.js";var h=class{constructor(e){this.sqlite=e,this._connectionDict=new Map}initWebStore(){return s(this,null,function*(){try{return yield this.sqlite.initWebStore(),Promise.resolve()}catch(e){return Promise.reject(e)}})}saveToStore(e){return s(this,null,function*(){try{return yield this.sqlite.saveToStore({database:e}),Promise.resolve()}catch(t){return Promise.reject(t)}})}saveToLocalDisk(e){return s(this,null,function*(){try{return yield this.sqlite.saveToLocalDisk({database:e}),Promise.resolve()}catch(t){return Promise.reject(t)}})}getFromLocalDiskToStore(e){return s(this,null,function*(){let t=e??!0;try{return yield this.sqlite.getFromLocalDiskToStore({overwrite:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}echo(e){return s(this,null,function*(){try{let t=yield this.sqlite.echo({value:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isSecretStored(){return s(this,null,function*(){try{let e=yield this.sqlite.isSecretStored();return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}setEncryptionSecret(e){return s(this,null,function*(){try{return yield this.sqlite.setEncryptionSecret({passphrase:e}),Promise.resolve()}catch(t){return Promise.reject(t)}})}changeEncryptionSecret(e,t){return s(this,null,function*(){try{return yield this.sqlite.changeEncryptionSecret({passphrase:e,oldpassphrase:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}clearEncryptionSecret(){return s(this,null,function*(){try{return yield this.sqlite.clearEncryptionSecret(),Promise.resolve()}catch(e){return Promise.reject(e)}})}checkEncryptionSecret(e){return s(this,null,function*(){try{let t=yield this.sqlite.checkEncryptionSecret({passphrase:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}addUpgradeStatement(e,t){return s(this,null,function*(){try{return e.endsWith(".db")&&(e=e.slice(0,-3)),yield this.sqlite.addUpgradeStatement({database:e,upgrade:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}createConnection(e,t,r,n,i){return s(this,null,function*(){try{e.endsWith(".db")&&(e=e.slice(0,-3)),yield this.sqlite.createConnection({database:e,encrypted:t,mode:r,version:n,readonly:i});let o=new u(e,i,this.sqlite),a=i?`RO_${e}`:`RW_${e}`;return this._connectionDict.set(a,o),Promise.resolve(o)}catch(o){return Promise.reject(o)}})}closeConnection(e,t){return s(this,null,function*(){try{e.endsWith(".db")&&(e=e.slice(0,-3)),yield this.sqlite.closeConnection({database:e,readonly:t});let r=t?`RO_${e}`:`RW_${e}`;return this._connectionDict.delete(r),Promise.resolve()}catch(r){return Promise.reject(r)}})}isConnection(e,t){return s(this,null,function*(){let r={};e.endsWith(".db")&&(e=e.slice(0,-3));let n=t?`RO_${e}`:`RW_${e}`;return r.result=this._connectionDict.has(n),Promise.resolve(r)})}retrieveConnection(e,t){return s(this,null,function*(){e.endsWith(".db")&&(e=e.slice(0,-3));let r=t?`RO_${e}`:`RW_${e}`;if(this._connectionDict.has(r)){let n=this._connectionDict.get(r);return typeof n<"u"?Promise.resolve(n):Promise.reject(`Connection ${e} is undefined`)}else return Promise.reject(`Connection ${e} does not exist`)})}getNCDatabasePath(e,t){return s(this,null,function*(){try{let r=yield this.sqlite.getNCDatabasePath({path:e,database:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}createNCConnection(e,t){return s(this,null,function*(){try{yield this.sqlite.createNCConnection({databasePath:e,version:t});let r=new u(e,!0,this.sqlite),n=`RO_${e})`;return this._connectionDict.set(n,r),Promise.resolve(r)}catch(r){return Promise.reject(r)}})}closeNCConnection(e){return s(this,null,function*(){try{yield this.sqlite.closeNCConnection({databasePath:e});let t=`RO_${e})`;return this._connectionDict.delete(t),Promise.resolve()}catch(t){return Promise.reject(t)}})}isNCConnection(e){return s(this,null,function*(){let t={},r=`RO_${e})`;return t.result=this._connectionDict.has(r),Promise.resolve(t)})}retrieveNCConnection(e){return s(this,null,function*(){if(this._connectionDict.has(e)){let t=`RO_${e})`,r=this._connectionDict.get(t);return typeof r<"u"?Promise.resolve(r):Promise.reject(`Connection ${e} is undefined`)}else return Promise.reject(`Connection ${e} does not exist`)})}isNCDatabase(e){return s(this,null,function*(){try{let t=yield this.sqlite.isNCDatabase({databasePath:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}retrieveAllConnections(){return s(this,null,function*(){return this._connectionDict})}closeAllConnections(){return s(this,null,function*(){let e=new Map;try{for(let t of this._connectionDict.keys()){let r=t.substring(3),n=t.substring(0,3)==="RO_";yield this.sqlite.closeConnection({database:r,readonly:n}),e.set(t,null)}for(let t of e.keys())this._connectionDict.delete(t);return Promise.resolve()}catch(t){return Promise.reject(t)}})}checkConnectionsConsistency(){return s(this,null,function*(){try{let e=[...this._connectionDict.keys()],t=[],r=[];for(let i of e)t.push(i.substring(0,2)),r.push(i.substring(3));let n=yield this.sqlite.checkConnectionsConsistency({dbNames:r,openModes:t});return n.result||(this._connectionDict=new Map),Promise.resolve(n)}catch(e){return this._connectionDict=new Map,Promise.reject(e)}})}importFromJson(e){return s(this,null,function*(){try{let t=yield this.sqlite.importFromJson({jsonstring:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isJsonValid(e){return s(this,null,function*(){try{let t=yield this.sqlite.isJsonValid({jsonstring:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}copyFromAssets(e){return s(this,null,function*(){let t=e??!0;try{return yield this.sqlite.copyFromAssets({overwrite:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}getFromHTTPRequest(e,t){return s(this,null,function*(){let r=t??!0;try{return yield this.sqlite.getFromHTTPRequest({url:e,overwrite:r}),Promise.resolve()}catch(n){return Promise.reject(n)}})}isDatabaseEncrypted(e){return s(this,null,function*(){e.endsWith(".db")&&(e=e.slice(0,-3));try{let t=yield this.sqlite.isDatabaseEncrypted({database:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isInConfigEncryption(){return s(this,null,function*(){try{let e=yield this.sqlite.isInConfigEncryption();return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}isInConfigBiometricAuth(){return s(this,null,function*(){try{let e=yield this.sqlite.isInConfigBiometricAuth();return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}isDatabase(e){return s(this,null,function*(){e.endsWith(".db")&&(e=e.slice(0,-3));try{let t=yield this.sqlite.isDatabase({database:e});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}getDatabaseList(){return s(this,null,function*(){try{let t=(yield this.sqlite.getDatabaseList()).values;t.sort();let r={values:t};return Promise.resolve(r)}catch(e){return Promise.reject(e)}})}getMigratableDbList(e){return s(this,null,function*(){let t=e||"default";try{let r=yield this.sqlite.getMigratableDbList({folderPath:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}addSQLiteSuffix(e,t){return s(this,null,function*(){let r=e||"default",n=t||[];try{let i=yield this.sqlite.addSQLiteSuffix({folderPath:r,dbNameList:n});return Promise.resolve(i)}catch(i){return Promise.reject(i)}})}deleteOldDatabases(e,t){return s(this,null,function*(){let r=e||"default",n=t||[];try{let i=yield this.sqlite.deleteOldDatabases({folderPath:r,dbNameList:n});return Promise.resolve(i)}catch(i){return Promise.reject(i)}})}moveDatabasesAndAddSuffix(e,t){return s(this,null,function*(){let r=e||"default",n=t||[];return this.sqlite.moveDatabasesAndAddSuffix({folderPath:r,dbNameList:n})})}},u=class{constructor(e,t,r){this.dbName=e,this.readonly=t,this.sqlite=r}getConnectionDBName(){return this.dbName}getConnectionReadOnly(){return this.readonly}open(){return s(this,null,function*(){try{return yield this.sqlite.open({database:this.dbName,readonly:this.readonly}),Promise.resolve()}catch(e){return Promise.reject(e)}})}close(){return s(this,null,function*(){try{return yield this.sqlite.close({database:this.dbName,readonly:this.readonly}),Promise.resolve()}catch(e){return Promise.reject(e)}})}beginTransaction(){return s(this,null,function*(){try{let e=yield this.sqlite.beginTransaction({database:this.dbName});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}commitTransaction(){return s(this,null,function*(){try{let e=yield this.sqlite.commitTransaction({database:this.dbName});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}rollbackTransaction(){return s(this,null,function*(){try{let e=yield this.sqlite.rollbackTransaction({database:this.dbName});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}isTransactionActive(){return s(this,null,function*(){try{let e=yield this.sqlite.isTransactionActive({database:this.dbName});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}loadExtension(e){return s(this,null,function*(){try{return yield this.sqlite.loadExtension({database:this.dbName,path:e,readonly:this.readonly}),Promise.resolve()}catch(t){return Promise.reject(t)}})}enableLoadExtension(e){return s(this,null,function*(){try{return yield this.sqlite.enableLoadExtension({database:this.dbName,toggle:e,readonly:this.readonly}),Promise.resolve()}catch(t){return Promise.reject(t)}})}getUrl(){return s(this,null,function*(){try{let e=yield this.sqlite.getUrl({database:this.dbName,readonly:this.readonly});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}getVersion(){return s(this,null,function*(){try{let e=yield this.sqlite.getVersion({database:this.dbName,readonly:this.readonly});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}getTableList(){return s(this,null,function*(){try{let e=yield this.sqlite.getTableList({database:this.dbName,readonly:this.readonly});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}execute(e,t=!0,r=!0){return s(this,null,function*(){try{if(this.readonly)return Promise.reject("not allowed in read-only mode");{let n=yield this.sqlite.execute({database:this.dbName,statements:e,transaction:t,readonly:!1,isSQL92:r});return Promise.resolve(n)}}catch(n){return Promise.reject(n)}})}query(e,t,r=!0){return s(this,null,function*(){let n;try{return t&&t.length>0?n=yield this.sqlite.query({database:this.dbName,statement:e,values:t,readonly:this.readonly,isSQL92:!0}):n=yield this.sqlite.query({database:this.dbName,statement:e,values:[],readonly:this.readonly,isSQL92:r}),n=yield this.reorderRows(n),Promise.resolve(n)}catch(i){return Promise.reject(i)}})}run(e,t,r=!0,n="no",i=!0){return s(this,null,function*(){let o;try{return this.readonly?Promise.reject("not allowed in read-only mode"):(t&&t.length>0?o=yield this.sqlite.run({database:this.dbName,statement:e,values:t,transaction:r,readonly:!1,returnMode:n,isSQL92:!0}):o=yield this.sqlite.run({database:this.dbName,statement:e,values:[],transaction:r,readonly:!1,returnMode:n,isSQL92:i}),o.changes=yield this.reorderRows(o.changes),Promise.resolve(o))}catch(a){return Promise.reject(a)}})}executeSet(e,t=!0,r="no",n=!0){return s(this,null,function*(){let i;try{return this.readonly?Promise.reject("not allowed in read-only mode"):(i=yield this.sqlite.executeSet({database:this.dbName,set:e,transaction:t,readonly:!1,returnMode:r,isSQL92:n}),i.changes=yield this.reorderRows(i.changes),Promise.resolve(i))}catch(o){return Promise.reject(o)}})}isExists(){return s(this,null,function*(){try{let e=yield this.sqlite.isDBExists({database:this.dbName,readonly:this.readonly});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}isTable(e){return s(this,null,function*(){try{let t=yield this.sqlite.isTableExists({database:this.dbName,table:e,readonly:this.readonly});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isDBOpen(){return s(this,null,function*(){try{let e=yield this.sqlite.isDBOpen({database:this.dbName,readonly:this.readonly});return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}delete(){return s(this,null,function*(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(yield this.sqlite.deleteDatabase({database:this.dbName,readonly:!1}),Promise.resolve())}catch(e){return Promise.reject(e)}})}createSyncTable(){return s(this,null,function*(){try{if(this.readonly)return Promise.reject("not allowed in read-only mode");{let e=yield this.sqlite.createSyncTable({database:this.dbName,readonly:!1});return Promise.resolve(e)}}catch(e){return Promise.reject(e)}})}setSyncDate(e){return s(this,null,function*(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(yield this.sqlite.setSyncDate({database:this.dbName,syncdate:e,readonly:!1}),Promise.resolve())}catch(t){return Promise.reject(t)}})}getSyncDate(){return s(this,null,function*(){try{let e=yield this.sqlite.getSyncDate({database:this.dbName,readonly:this.readonly}),t="";return e.syncDate>0&&(t=new Date(e.syncDate*1e3).toISOString()),Promise.resolve(t)}catch(e){return Promise.reject(e)}})}exportToJson(e,t=!1){return s(this,null,function*(){try{let r=yield this.sqlite.exportToJson({database:this.dbName,jsonexportmode:e,readonly:this.readonly,encrypted:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}deleteExportedRows(){return s(this,null,function*(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(yield this.sqlite.deleteExportedRows({database:this.dbName,readonly:!1}),Promise.resolve())}catch(e){return Promise.reject(e)}})}executeTransaction(e,t=!0){return s(this,null,function*(){let r=0,n=!1;if(this.readonly)return Promise.reject("not allowed in read-only mode");if(yield this.sqlite.beginTransaction({database:this.dbName}),n=yield this.sqlite.isTransactionActive({database:this.dbName}),!n)return Promise.reject("After Begin Transaction, no transaction active");try{for(let a of e){if(typeof a!="object"||!("statement"in a))throw new Error("Error a task.statement must be provided");if("values"in a&&a.values&&a.values.length>0){let c=a.statement.toUpperCase().includes("RETURNING")?"all":"no",m=yield this.sqlite.run({database:this.dbName,statement:a.statement,values:a.values,transaction:!1,readonly:!1,returnMode:c,isSQL92:t});if(m.changes.changes<0)throw new Error("Error in transaction method run ");r+=m.changes.changes}else{let c=yield this.sqlite.execute({database:this.dbName,statements:a.statement,transaction:!1,readonly:!1});if(c.changes.changes<0)throw new Error("Error in transaction method execute ");r+=c.changes.changes}}let i=yield this.sqlite.commitTransaction({database:this.dbName});r+=i.changes.changes;let o={changes:{changes:r}};return Promise.resolve(o)}catch(i){let o=i.message?i.message:i;return yield this.sqlite.rollbackTransaction({database:this.dbName}),Promise.reject(o)}})}reorderRows(e){return s(this,null,function*(){let t=e;if(e?.values&&typeof e.values[0]=="object"&&Object.keys(e.values[0]).includes("ios_columns")){let r=e.values[0].ios_columns,n=[];for(let i=1;i<e.values.length;i++){let o=e.values[i],a={};for(let c of r)a[c]=o[c];n.push(a)}t.values=n}return Promise.resolve(t)})}};var w=P("CapacitorSQLite",{web:()=>import("./chunk-CGTEZCOG.js").then(l=>new l.CapacitorSQLiteWeb),electron:()=>window.CapacitorCustomPlatform.plugins.CapacitorSQLite});var b="USER",T=(()=>{let e=class e{constructor(){this.sqlite=new h(w),this.users=y([])}initializPlugin(){return s(this,null,function*(){return this.db=yield this.sqlite.createConnection(b,!1,"no-encryption",1,!1),yield this.db.open(),yield this.db.execute(`CREATE TABLE IF NOT EXISTS users ( 
        user_id INTEGER PRIMARY KEY AUTOINCREMENT,
        username TEXT NOT NULL,
        contact_detail TEXT,
        dob DATE,
        notes TEXT,
        active INTEGER DEFAULT 1 
  );`),this.loadUsers(),!0})}getUsers(){return this.users}loadUsers(){return s(this,null,function*(){let r=yield this.db.query("SELECT * FROM users;");this.users.set(r.values||[])})}addUser(r,n,i,o){return s(this,null,function*(){let a=`INSERT INTO users (username, contact_detail, dob, notes) VALUES ('${r}', '${n}', '${i?.toISOString()}', '${o}');`,c=yield this.db.query(a);return this.loadUsers(),c})}updateUser(r){return s(this,null,function*(){let n=`UPDATE users SET 
      username='${r.username}', 
      contact_detail='${r.contact_detail}', 
      dob='${r.dob.toISOString()}', 
      notes='${r.notes}' 
      WHERE user_id=${r.user_id};`,i=yield this.db.query(n);return this.loadUsers(),i})}deleteUser(r){return s(this,null,function*(){let n=`DELETE FROM users WHERE user_id=${r};`,i=yield this.db.query(n);return this.loadUsers(),i})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"root"});let l=e;return l})();export{T as a};
